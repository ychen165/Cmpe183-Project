{{extend 'layout.html'}}

{{block head}}

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
      integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
<link rel="stylesheet" href="{{=URL('static', 'css/index.css')}}">
<script src="{{=URL('static', 'js/vue.js')}}"></script>
<script>
    var add_post_url = "{{=URL('api', 'add_post', user_signature=True)}}";
    var get_post_list_url = "{{=URL('api', 'get_post_list')}}";
    var get_reply_list_url = "{{=URL('api', 'get_reply_list', user_signature=True)}}";
    var add_reply_url = "{{=URL('api', 'add_reply', user_signature=True)}}";
    var edit_reply_url = "{{=URL('api', 'edit_reply', user_signature=True)}}";
    var edit_post_url = "{{=URL('api', 'edit_post', user_signature=True)}}";

    var is_logged_in = {{='false' if auth.user is None else 'true'}};

    var set_thumb_url = "{{=URL('api', 'set_thumb', user_signature=True)}}";
    //var show_form = {{='false' if auth.user is None else 'true'}};
    var useremail="{{='' if auth.user is None else auth.user.email}}";


</script>
{{end}}

<div class="main_content">

    <div id="vue-div" class="display:none">
        <!-- Your code goes here.  Remember to call $("#vue-div").show() once you get the data for the first time. -->
        <button v-if="is_logged_in" id="show_form" class="fas fa-plus"
                v-on:click="display_form">
            Add Post
        </button>

        <!-- First, let's add a form to insert blog posts. -->
        <div id="add_post" style="display:none">
            <div class="container form_row">
                <div class="label quarter">
                    Title:
                </div>

                <div class="form threequarters">
                    <input v-model="form_title" placeholder="Enter the post title"/>
                </div>
            </div>

            <div class="container form_row">
                <div class="label quarter">
                    Content:
                </div>

                <div class="form threequarters">
                    <textarea v-model="form_content" placeholder="Enter the content of your post"></textarea>
                </div>
            </div>

            <div class="container form_row">
                <div class="quarter"></div>
                <div class="threequarters">
                    <div class="submit">
                        <button id="add-post" v-on:click="add_post">Submit</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Message in case there are no posts. -->
        <div v-if="post_list.length === 0">There are no posts.</div>

        <!-- We display the posts. -->
        <div id="post_list">
            <div class="post_div" v-for="post in post_list">
                <div v-if="is_logged_in&&useremail==post.post_author" style="float: middle">
                    <button class="fa fa-pencil-square-o" v-on:click="edit_post_click(post._idx)">${post.editing?'Submit':'Edit'}</button>
                </div>
                <div v-if="!post.editing" class="post_title">${post.post_title}</div>
                <div v-if="!post.editing" class="post_content">${post.post_content}</div>
                <div style="clear: both;">
                    <div v-if="post.editing" class="container form_row">
                        <div class="label quarter">
                            Title:
                        </div>

                        <div class="form threequarters">
                            <input v-model="post.post_title" placeholder="Enter the post title"/>
                        </div>
                    </div>

                    <div v-if="post.editing" class="container form_row">
                        <div class="label quarter">
                            Content:
                        </div>

                        <div class="form threequarters">
                            <textarea v-model="post.post_content" placeholder="Enter the content of your post"></textarea>
                        </div>
                    </div>

                </div>

                <div class="attributes">
                    <!-- Code for Thumbups. -->
                    <div class="thumbers">
                        <span v-if="is_logged_in" class="toggle_thumb"
                              v-on:mouseover="thumbup_mouseover(post._idx)"
                              v-on:mouseout=" thumbup_mouseout(post._idx)"
                              v-on:click="thumbup_click(post._idx)">
                          <!--是u的时候，只有放在d上才变化-->
                           <i v-if="post.thumb === 'u' && post.thumb === post._thumbdown" class="fas fa-thumbs-up"></i>
                          <i v-if="post.thumb === 'u' && post.thumb !== post._thumbdown" class="far fa-thumbs-up changed"></i>
                            <!--是d的时候，放在u上会变化-->
                          <i v-if="post.thumb === 'd' && post._thumbup !== post.thumb" class="fas fa-thumbs-up changed"></i>
                          <i v-if="post.thumb === 'd' && post._thumbup === post.thumb" class="far fa-thumbs-up"></i>
                            <!--如果不是u也不是d，放得时候会变化-->
                          <i v-if="post.thumb !== 'u' && post.thumb !== 'd' && post._thumbdown === post.thumb && post._thumbup !== post.thumb"
                             class="fas fa-thumbs-up changed"></i>
                          <i v-if="post.thumb !== 'u' && post.thumb !== 'd' && post._thumbdown === post.thumb  && post._thumbup === post.thumb"
                             class="far fa-thumbs-up"></i>
                          <i v-if="post.thumb !== 'u' && post.thumb !== 'd' && post._thumbdown !== post.thumb"
                             class="far fa-thumbs-up changed"></i>
                        </span>
                                <span class="toggle_thumb">${post.count}</span>
                                <span v-if="is_logged_in" class="toggle_thumb"
                                      v-on:mouseover="thumbdown_mouseover(post._idx)"
                                      v-on:mouseout=" thumbdown_mouseout(post._idx)"
                                      v-on:click="thumbdown_click(post._idx)">

                           <!--是d的时候，只有放在u上才变化-->
                          <i v-if="post.thumb === 'd' && post.thumb === post._thumbup" class="fas fa-thumbs-down"></i>
                          <i v-if="post.thumb === 'd' && post.thumb !== post._thumbup" class="far fa-thumbs-down changed"></i>
                                    <!--是d的时候，放在u上会变化-->
                          <i v-if="post.thumb === 'u' && post._thumbdown !== post.thumb" class="fas fa-thumbs-down changed"></i>
                          <i v-if="post.thumb === 'u' && post._thumbdown === post.thumb" class="far fa-thumbs-down"></i>
                                    <!--如果不是u也不是d，放得时候会变化-->
                          <i v-if="post.thumb !== 'u' && post.thumb !== 'd' && post._thumbup === post.thumb && post._thumbdown !== post.thumb"
                             class="fas fa-thumbs-down changed"></i>
                          <i v-if="post.thumb !== 'u' && post.thumb !== 'd' && post._thumbup === post.thumb  && post._thumbdown === post.thumb"
                             class="far fa-thumbs-down"></i>
                          <i v-if="post.thumb !== 'u' && post.thumb !== 'd' && post._thumbup !== post.thumb"
                             class="far fa-thumbs-down changed"></i>
                        </span>
                    </div>
                </div>
                <div >
                    <button v-if="is_logged_in" v-on:click="post_reply_click(post._idx)"  >
                        ${expanded_idx==post._idx?'Hide reply':'Reply / Show Replies'}
                    </button>
                        <div class="reply_list" v-if="expanded_idx==post._idx">
                            <div>
                                <div class="container form_row">
                                    <div class="label quarter">
                                        Add your reply here:
                                    </div>
                                    <div class="form threequarters">
                                        <textarea v-model="reply_content" placeholder="Enter your reply here" class="reply_box"></textarea>
                                    </div>
                                </div>

                                <div>
                                    <button v-on:click="reply_submit_click(post._idx)">Add reply</button>
                                </div>
                            </div>
                            <div class="replyitem" v-for="reply in reply_list">

                                <div v-if="useremail==reply.reply_author" style="float: left">
                                    <button class="fa fa-pencil-square-o" v-on:click="edit_reply_click(reply)">${reply.editing?'Submit':'Edit'}</button>
                                </div>
                                <div v-if="!reply.editing">
                                    <span>${reply.reply_content}</span>
                                </div>

<!--                                 <div class="reply_time" v-if="!reply.editing">
                                    <span class="post_content">${reply.reply_time}</span>
                                </div> -->
                                <div style="clear: both;">
                                    <div v-if="reply.editing" class="container form_row">
                                        <div class="label quarter">
                                            Reply Content:
                                        </div>

                                        <div class="form threequarters">
                                            <input v-model="reply.reply_content" placeholder="Enter reply content here"/>
                                        </div>
                                    </div>


                                </div>

                            </div>
                        </div>
                </div>
            </div>
        </div>

    </div>
</div>


<script src="{{=URL('static', 'js/default_index.js')}}"></script>
